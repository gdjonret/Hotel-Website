<!DOCTYPE html>
<html lang="en">
<head>
    <%- include("../partials/head") %>
    <link rel="stylesheet" href="/css/admin.css">
    <title>Admin - Room Types - Hotel Le Process</title>
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .room-type-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .room-type-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .room-type-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .info-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .info-item label {
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
            display: block;
            margin-bottom: 5px;
        }
        .info-item .value {
            color: #333;
            font-size: 1.1em;
        }
        .btn-group {
            display: flex;
            gap: 10px;
        }
        .badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .badge-active {
            background: #28a745;
            color: white;
        }
        .badge-inactive {
            background: #dc3545;
            color: white;
        }
        .amenities-list {
            list-style: none;
            padding: 0;
        }
        .amenities-list li {
            padding: 5px 0;
        }
        .amenities-list li:before {
            content: "âœ“ ";
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <%- include("../partials/navbar.ejs") %>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-bed"></i> Room Types Management</h1>
            <button class="btn btn-primary" onclick="window.location.href='/'">
                <i class="fas fa-home"></i> Back to Home
            </button>
        </div>

        <div id="room-types-container">
            <div class="text-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <%- include("../partials/footer.ejs") %>

    <script>
        const API_BASE_URL = '<%= process.env.BACKEND_URL || "http://localhost:8080" %>';

        async function loadRoomTypes() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/public/room-types`);
                const roomTypes = await response.json();
                displayRoomTypes(roomTypes);
            } catch (error) {
                console.error('Error loading room types:', error);
                document.getElementById('room-types-container').innerHTML = 
                    '<div class="alert alert-danger">Error loading room types. Please try again.</div>';
            }
        }

        function displayRoomTypes(roomTypes) {
            const container = document.getElementById('room-types-container');
            
            if (roomTypes.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No room types found.</div>';
                return;
            }

            container.innerHTML = roomTypes.map(rt => {
                let amenities = { equipment: [], amenities: [] };
                try {
                    amenities = JSON.parse(rt.amenitiesJson || '{}');
                } catch (e) {
                    console.error('Error parsing amenities:', e);
                }

                return `
                    <div class="room-type-card">
                        <div class="room-type-header">
                            <div>
                                <h3>${rt.name}</h3>
                                <span class="badge ${rt.active ? 'badge-active' : 'badge-inactive'}">
                                    ${rt.active ? 'Active' : 'Inactive'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="room-type-info">
                            <div class="info-item">
                                <label>Code</label>
                                <div class="value">${rt.code}</div>
                            </div>
                            <div class="info-item">
                                <label>Max Capacity</label>
                                <div class="value"><i class="fas fa-users"></i> ${rt.capacity} Guest${rt.capacity > 1 ? 's' : ''}</div>
                            </div>
                            <div class="info-item">
                                <label>Price per Night</label>
                                <div class="value"><i class="fas fa-money-bill"></i> ${rt.baseRate.toLocaleString()} FCFA</div>
                            </div>
                            <div class="info-item">
                                <label>Sort Order</label>
                                <div class="value">${rt.sortOrder || 'N/A'}</div>
                            </div>
                        </div>

                        ${amenities.equipment && amenities.equipment.length > 0 ? `
                            <div class="mt-3">
                                <label><i class="fas fa-snowflake"></i> Equipment</label>
                                <ul class="amenities-list">
                                    ${amenities.equipment.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        ${amenities.amenities && amenities.amenities.length > 0 ? `
                            <div class="mt-3">
                                <label><i class="fas fa-wifi"></i> Amenities</label>
                                <ul class="amenities-list">
                                    ${amenities.amenities.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Load room types on page load
        document.addEventListener('DOMContentLoaded', loadRoomTypes);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
